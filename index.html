<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fitness App</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f5f5f5;
            margin: 0;
            padding: 0;
        }
        header {
            background-color: #333;
            color: #fff;
            padding: 10px;
            text-align: center;
        }
        #main {
            padding: 20px;
            text-align: center;
        }
        .button, .save-button, .delete-button, .back-button {
            padding: 10px 20px;
            margin: 10px;
            background-color: #333;
            color: #fff;
            border: none;
            cursor: pointer;
        }
        .button:hover, .save-button:hover, .delete-button:hover, .back-button:hover {
            background-color: #555;
        }
        .delete-button {
            background-color: red;
        }
    </style>
</head>
<body>
    <header>
        <h1>Fitness App</h1>
        <button class="button" onclick="viewUserInfo()">Ver Info Usuario</button>
        <button class="button" onclick="editUserInfo()">Editar Info Usuario</button>
    </header>

    <div id="main">
        <!-- Aquí se cargará el contenido dinámico -->
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        let users = [];
        let routines = [];
        let currentUser = null;

        function showLoginScreen() {
            const main = document.getElementById('main');
            main.innerHTML = `
                <h2>Iniciar Sesión</h2>
                <input type="text" id="username" placeholder="Nombre de Usuario"><br><br>
                <button class="button" onclick="login()">Iniciar Sesión</button><br>
                <a href="#" onclick="showRegisterScreen()">¿No tienes cuenta? Regístrate</a>
            `;
        }

        function showRegisterScreen() {
            const main = document.getElementById('main');
            main.innerHTML = `
                <h2>Registro de Usuario</h2>
                <input type="text" id="username" placeholder="Nombre de Usuario"><br><br>
                <input type="number" id="weight" placeholder="Peso (kg)"><br><br>
                <input type="number" id="height" placeholder="Altura (cm)"><br><br>
                <button class="save-button" onclick="registerUser()">Registrarse</button><br>
                <button class="back-button" onclick="showLoginScreen()">Volver</button>
            `;
        }

        function registerUser() {
            const username = document.getElementById('username').value;
            const weight = document.getElementById('weight').value;
            const height = document.getElementById('height').value;

            if (!username || !weight || !height) {
                alert('Por favor, completa todos los campos.');
                return;
            }

            const user = { username, weight, height };
            users.push(user);
            saveToFile("users", users);

            alert('Usuario registrado con éxito!');
            showLoginScreen();
        }

        function login() {
            const username = document.getElementById('username').value;
            users = readFromFile("users");

            const user = users.find(u => u.username === username);
            if (!user) {
                alert('Usuario no encontrado.');
                return;
            }

            currentUser = user;
            showMainScreen();
        }

        function showMainScreen() {
            const main = document.getElementById('main');
            main.innerHTML = `
                <h2>Bienvenido, ${currentUser.username}</h2>
                <button class="button" onclick="manageRoutines()">Ver Rutinas</button><br>
                <button class="button" onclick="registerExercise()">Registrar Ejercicio Realizado</button><br>
                <button class="button" onclick="viewProgress()">Ver Progreso</button><br>
            `;
        }

        function viewUserInfo() {
            const main = document.getElementById('main');
            main.innerHTML = `
                <h2>Información del Usuario</h2>
                <p>Nombre: ${currentUser.username}</p>
                <p>Peso: ${currentUser.weight} kg</p>
                <p>Altura: ${currentUser.height} cm</p>
                <button class="back-button" onclick="showMainScreen()">Volver</button>
            `;
        }

        function editUserInfo() {
            const main = document.getElementById('main');
            main.innerHTML = `
                <h2>Editar Información del Usuario</h2>
                <input type="text" id="username" value="${currentUser.username}" placeholder="Nombre de Usuario"><br><br>
                <input type="number" id="weight" value="${currentUser.weight}" placeholder="Peso (kg)"><br><br>
                <input type="number" id="height" value="${currentUser.height}" placeholder="Altura (cm)"><br><br>
                <button class="save-button" onclick="saveUserInfo()">Guardar Cambios</button><br>
                <button class="back-button" onclick="showMainScreen()">Volver</button>
            `;
        }

        function saveUserInfo() {
            const username = document.getElementById('username').value;
            const weight = document.getElementById('weight').value;
            const height = document.getElementById('height').value;

            currentUser.username = username;
            currentUser.weight = weight;
            currentUser.height = height;

            saveToFile("users", users);
            alert('Información guardada con éxito!');
            showMainScreen();
        }

        function manageRoutines() {
            const main = document.getElementById('main');
            main.innerHTML = `
                <h2>Gestionar Rutinas</h2>
                <button class="button" onclick="addRoutine()">Agregar Rutina</button><br>
                <button class="button" onclick="viewRoutines()">Ver Rutinas</button><br>
                <button class="button" onclick="deleteRoutines()">Eliminar Rutinas</button><br>
                <button class="back-button" onclick="showMainScreen()">Volver</button>
            `;
        }

        function addRoutine() {
            const main = document.getElementById('main');
            main.innerHTML = `
                <h2>Agregar Rutina</h2>
                <input type="text" id="exercise" placeholder="Ejercicio"><br><br>
                <input type="number" id="reps" placeholder="Repeticiones"><br><br>
                <input type="number" id="sets" placeholder="Series"><br><br>
                <button class="save-button" onclick="saveRoutine()">Guardar Rutina</button><br>
                <button class="back-button" onclick="manageRoutines()">Volver</button>
            `;
        }

        function saveRoutine() {
            const exercise = document.getElementById('exercise').value;
            const reps = document.getElementById('reps').value;
            const sets = document.getElementById('sets').value;

            if (!exercise || !reps || !sets) {
                alert('Por favor, completa todos los campos.');
                return;
            }

            const routine = { exercise, reps, sets };
            routines.push(routine);
            saveToFile("routines", routines);

            alert('Rutina guardada con éxito!');
            manageRoutines();
        }

        function viewRoutines() {
            const main = document.getElementById('main');
            main.innerHTML = `
                <h2>Ver Rutinas</h2>
                <ul id="routineList"></ul>
                <button class="back-button" onclick="manageRoutines()">Volver</button>
            `;

            const routineList = document.getElementById('routineList');
            routines.forEach((routine, index) => {
                const listItem = document.createElement('li');
                listItem.textContent = `Rutina ${index + 1}: ${routine.exercise}, ${routine.reps} repeticiones, ${routine.sets} series`;
                routineList.appendChild(listItem);
            });
        }

        function deleteRoutines() {
            const main = document.getElementById('main');
            main.innerHTML = `
                <h2>Eliminar Rutinas</h2>
                <ul id="routineList"></ul>
                <button class="back-button" onclick="manageRoutines()">Volver</button>
            `;

            const routineList = document.getElementById('routineList');
            routines.forEach((routine, index) => {
                const listItem = document.createElement('li');
                listItem.innerHTML = `
                    Rutina ${index + 1}: ${routine.exercise}, ${routine.reps} repeticiones, ${routine.sets} series 
                    <button class="delete-button" onclick="deleteRoutine(${index})">Eliminar</button>
                `;
                routineList.appendChild(listItem);
            });
        }

        function deleteRoutine(index) {
            routines.splice(index, 1);
            saveToFile("routines", routines);
            deleteRoutines(); // Recargar la lista de rutinas
        }

        function registerExercise() {
            const main = document.getElementById('main');
            let routineOptions = routines.map((routine, index) => `
                <option value="${index}">${routine.exercise}</option>
            `).join('');

            main.innerHTML = `
                <h2>Registrar Ejercicio Realizado</h2>
                <label>Seleccionar Rutina:</label>
                <select id="routineSelect">
                    ${routineOptions}
                </select><br><br>
                <label>Fecha y Hora:</label>
                <input type="datetime-local" id="datetime"><br><br>
                <button class="save-button" onclick="saveExercise()">Guardar Registro</button><br>
                <button class="back-button" onclick="showMainScreen()">Volver</button>
            `;
        }

        function saveExercise() {
            const routineIndex = document.getElementById('routineSelect').value;
            const datetime = document.getElementById('datetime').value;

            if (!datetime) {
                alert('Por favor, selecciona una fecha y hora.');
                return;
            }

            const exerciseRecord = {
                routine: routines[routineIndex],
                datetime,
                user: currentUser.username  // Asignar el ejercicio al usuario actual
            };

            let exerciseRecords = readFromFile("exerciseRecords");
            exerciseRecords.push(exerciseRecord);
            saveToFile("exerciseRecords", exerciseRecords);

            alert('Ejercicio registrado con éxito!');
            showMainScreen();
        }

        function viewProgress() {
            const main = document.getElementById('main');
            main.innerHTML = `
                <h2>Progreso</h2>
                <canvas id="progressChart"></canvas><br>
                <button class="back-button" onclick="showMainScreen()">Volver</button>
            `;

            const ctx = document.getElementById('progressChart').getContext('2d');
            const exerciseRecords = readFromFile("exerciseRecords");
            const userRecords = exerciseRecords.filter(record => record.user === currentUser.username); // Filtrar ejercicios por usuario actual

            const dates = userRecords.map(record => new Date(record.datetime).toLocaleDateString());
            const routinesDone = userRecords.map(record => record.routine.exercise);

            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: dates,
                    datasets: [{
                        label: 'Ejercicios Realizados',
                        data: routinesDone.map((_, i) => i + 1),
                        backgroundColor: 'rgba(75, 192, 192, 0.2)',
                        borderColor: 'rgba(75, 192, 192, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        function saveToFile(key, data) {
            localStorage.setItem(key, JSON.stringify(data));
        }

        function readFromFile(key) {
            const data = localStorage.getItem(key);
            return data ? JSON.parse(data) : [];
        }

        // Mostrar pantalla de inicio de sesión al cargar la página
        window.onload = showLoginScreen;
    </script>
</body>
</html>
